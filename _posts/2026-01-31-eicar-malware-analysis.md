---
layout: post
title: "EICAR Test File Analysis - Validating My Malware Lab"
date: 2026-01-31
categories: [ malware ]
permalink: /malware/eicar-analysis/
tags: [malware-analysis, EICAR, windows-defender, procmon, homelab]
image: assets/images/malware/eicar/03-procmon-deletion.png
---

My first malware analysis in my new Proxmox-based incident response homelab. To validate my analysis environment and establish a baseline workflow, I started with the EICAR test file - a harmless antivirus test string that all AV products recognize as malicious.

## What is EICAR?

The EICAR (European Institute for Computer Antivirus Research) test file is an industry-standard tool for testing antivirus software. It's a 68-byte text string that all antivirus vendors agree to detect, allowing security professionals to verify their tools work without handling actual malware.

**Sample Details:**
- **Filename:** eicar.txt
- **SHA256:** `275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f`
- **Size:** 68 bytes
- **Type:** Plain text EICAR test string

## Analysis Environment

- **Platform:** FLARE VM (Windows 11) - Mandiant's malware analysis distribution
- **Network:** Isolated (192.168.100.110) - no internet access
- **Virtualization:** Proxmox VE with snapshot capability
- **Tools:** Process Monitor (Procmon), TCPView, Process Explorer

## Phase 1: Verifying Isolation

Before executing any sample, I verified the VM was properly isolated from the internet.

![Isolation Verified](/assets/images/malware/eicar/01-isolation-verified.png)

The `Test-NetConnection 8.8.8.8` command failed with "TimedOut" - confirming no internet connectivity. The file hash was also verified to match the known EICAR signature.

## Phase 2: Execution and Detection

With Process Monitor and TCPView running, I attempted to open the EICAR file. Windows Defender immediately detected and blocked the threat.

![Defender Detection](/assets/images/malware/eicar/02-defender-detection.png)

**Observations:**
- Notepad displayed: "Operation did not complete successfully because the file contains a virus or potentially unwanted software"
- Windows Security notification: "Threats found - Microsoft Defender Antivirus found threats"
- Detection was instantaneous upon file access

## Phase 3: Process Monitor Analysis

Filtering Procmon for "eicar" revealed the complete kill chain executed by Windows Defender (MsMpEng.exe):

![Procmon Deletion](/assets/images/malware/eicar/03-procmon-deletion.png)

**Timeline of Defender's Response:**

| Time | Process | Action |
|------|---------|--------|
| 12:17:10.56 | MsMpEng.exe | QueryNameInfo, ReadFile - Scanning the file |
| 12:17:10.57 | MsMpEng.exe | SetDispositionInfo - **Delete: True** |
| 12:17:10.57 | MsMpEng.exe | DELETE PENDING - File deletion in progress |
| 12:17:10.58 | MsMpEng.exe | NAME NOT FOUND - File successfully removed |
| 12:17:11.57 | Explorer.EXE | NO SUCH FILE - Explorer confirms deletion |
| 12:17:40.58 | MsMpEng.exe | Checking .exe, .dll, .lnk, .cmd, .bat, .com, .pif variants |

**Key Finding:** After deleting the threat, Defender proactively searched for related malicious variants with different extensions (eicar.txt.exe, eicar.txt.dll, etc.) - demonstrating defense-in-depth behavior.

## Network Activity

TCPView showed **no network connections** from the EICAR file - expected since it's just a test string with no C2 functionality. This is a valid finding: the sample made no attempt to communicate externally.

## Indicators of Compromise (IOCs)

**File Hash:**
- SHA256: `275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f`
- MD5: `44d88612fea8a8f36de82e1278abb02f`

**Detection Signature:**
- EICAR test string (detected by all major AV vendors)
- Threat name: Virus:DOS/EICAR_Test_File

**Network IOCs:** None (no network functionality)

**Persistence Mechanisms:** None

## VM Restoration

After completing the analysis, I restored the FLARE VM to its clean state using Proxmox snapshots:

```bash
qm stop 110 && qm rollback 110 before-eicar && qm start 110
```

Total time from detection to restored clean state: under 2 minutes.

## Key Takeaways

1. **Isolation works** - The VM had no internet connectivity, ensuring safe detonation
2. **Defender responded correctly** - Immediate detection, quarantine, and variant hunting
3. **Procmon is essential** - Captured the complete timeline of Defender's response
4. **Snapshot workflow is efficient** - Quick restoration enables rapid iteration

## What's Next

This baseline analysis validated my lab environment. Next up: **WannaCry ransomware** - a real sample with actual malicious behavior including file encryption and network propagation attempts.

---

*Analysis performed on FLARE VM in an isolated Proxmox environment. No actual malware was released into any production network.*
